resources:
  accelerators: V100:1  # 1x NVIDIA V100 GPU

num_nodes: 1  # Number of VMs to launch

# Working directory (optional) containing the project codebase.
# Its contents are synced to ~/sky_workdir/ on the cluster.
workdir: .

# Commands to be run before executing the job.
# Typical use: pip install -r requirements.txt, git clone, etc.
setup: |
  docker pull mosaicml/composer
  docker run -it --name composer mosaicml/composer:latest
  sudo apt update
  sudo apt -y upgrade
  python3 -m venv falcon-env
  source falcon-env/bin/activate
  python3 -m pip install --upgrade pip
  pip install huggingface_hub
  pip install jsonargparse
  git clone https://github.com/byte-genie/lit-gpt.git
  cd lit-gpt
  python scripts/download.py --repo_id tiiuae/falcon-7b
  pip install --index-url https://download.pytorch.org/whl/nightly/cu118 --pre 'torch>=2.1.0dev'
  pip install -r requirements.txt
  python scripts/convert_hf_checkpoint.py --checkpoint_dir checkpoints/tiiuae/falcon-7b

# Commands to run as a job.
# Typical use: launch the main program.
run: |
  python scripts/prepare_alpaca.py
  python finetune/adapter_v2.py